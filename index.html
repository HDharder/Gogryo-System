<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Menu Gogryõ</title>
  <style>
    @page {
      size: A4;
      margin: 20mm;
    }

    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 297mm;
      width: 840mm;
      background: #fff;
      font-family: Arial, sans-serif;
    }

    .page {
      position: relative;
      width: 210mm;
      height: 297mm;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid #000;
      box-sizing: border-box;
    }

    /* --- Header (400px) --- */
    .header {
      width: 100%;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 100px;
      border-bottom: 5px double #000;
    }

    .header img {
      max-height: 300px;
      width: auto;
    }

    .header-fields {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .input-row {
      display: flex;
      justify-content: center;
      gap: 50px;
      margin-bottom: 30px;
    }

    .field {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    input {
      border: none;
      border-bottom: 2px solid black;
      font-size: 18px;
      text-align: center;
      padding: 5px;
      width: 200px;
      outline: none;
    }

    .caption {
      font-size: 14px;
      color: gray;
      margin-top: 5px;
    }

    /* --- Menu --- */
    .menu {
      position: relative;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      margin-top: 5px;
      max-width: 80%;
      max-height: 30%;
    }

    .menu img {
      width: 50%;
      height: auto;
    }
    
    .attribute-container {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    }

    .attribute-input {
    width: 50px;
    text-align: center;
    border: none;
    border-bottom: 2px solid black;
    font-size: 36px;
    background: transparent;
    }

    .attribute-caption {
    font-size: 12px;
    color: gray;
    margin-top: 3px;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
    input[type="number"]:hover,
    input[type="number"]:focus {
        -moz-appearance: number-input;
    }

    /*.atributes {
      position: absolute;
      display: inline-flex;
      justify-content: left;
      align-items:start;
      gap: 10px; 
      top: 180px;
      left: 0px;
      max-width: 20%;
      width: 20%;
      height: 80%;
      max-height: 80%;
      padding: 10px;
      border-right: 1px solid #000;
    }*/

    .atributes {
      position: absolute;
      top: 160px;
      left: 1%;
      display: flex;          /* em vez de inline-flex */
      flex-direction: column; /* organiza em coluna */
      gap: 10px;              /* espaço vertical entre linhas */
      border: 1px solid #000;
      border-radius: 5px;
      padding-right: 10px;
      padding-top: 20px;
      padding-bottom: 20px;
      max-width: 25%;
      width: 25%
    }

    .atbBox {
      border: none;
      border-bottom: 2px solid black;
      font-size: 18px;
      text-align: center;
      width: 20px;
      left: 0%;
      outline: none; 
    }

    .bonus-row {
      display:inline-flex;
      align-items: center;
      gap: 10px;
    }

    .main {
      position: absolute;
      top: 160px;
      right: 1%;
      display: flex;          /* em vez de inline-flex */
      flex-direction: column; /* organiza em coluna */
      gap: 10px;              /* espaço vertical entre linhas */
      border: 1px solid #000;
      border-radius: 5px;
      padding-left: 10px;
      padding-top: 36px;
      padding-bottom: 36px;
      max-width: 25%;
      width: 25%
    }

    /* The Energy */
    .container {
      display: block;
      position: relative;
      padding: 5px;
      padding-left: 35px;
      margin-bottom: 12px;
      cursor: pointer;
      font-size: 22px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* Hide the browser's default radio button */
    .container input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }

    /* Create a custom radio button */
    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 25px;
      width: 25px;
      background-color: #eee;
      border-radius: 50%;
    }

    /* On mouse-over, add a grey background color */
    .container:hover input ~ .checkmark {
      background-color: #ccc;
    }

    /* When the radio button is checked, add a blue background */
    .container input:checked ~ .checkmark {
      background-color: green;
    }

    /* Create the indicator (the dot/circle - hidden when not checked) */
    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
    }

    /* Show the indicator (dot/circle) when checked */
    .container input:checked ~ .checkmark:after {
      display: block;
    }

    /* Style the indicator (dot/circle) */
    .container .checkmark:after {
      top: 9px;
      left: 9px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: white;
    }

    .energy-boxes input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    /* aparência quando desabilitado (usa a estrutura .container .checkmark que já tem) */
    .container input:disabled ~ .checkmark {
      background-color: #000;     /* tom cinza para indicar disabled */
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* se estiver disabled e também checked (caso queira outro visual) */
    .container input:checked:disabled ~ .checkmark {
      background-color: #bbb;
    }

    /* indicador menor/opaco quando disabled e checked */
    .container input:checked:disabled ~ .checkmark:after {
      background: #fff;
      opacity: 0.8;
    }

    #quadstate {
      width: 25px; height: 25px;
      border: 2px solid #333;
      display: inline-block;
      border-radius: 25px;
      cursor: pointer;
    }
    .state-0 { background: white; }
    .state-1 { background: lightblue; }
    .state-2 { background: blue; }
    .state-3 { background: darkblue; }


    /* Skills */
    .skills {
      position: absolute;
      bottom: 10px;
      left: 1%;
      display: flex;          /* em vez de inline-flex */
      flex-direction: column; /* organiza em coluna */
      gap: 10px;              /* espaço vertical entre linhas */
      border: 1px solid #000;
      border-radius: 5px;
      padding-right: 10px;
      padding-top: 20px;
      padding-bottom: 20px;
      max-width: 33%;
      width: 33%
    }

    /* Equipment */
    .equip {
      display: block;
      position: relative;
      bottom: 10px;
      left: 0%;
      /*flex-direction: column; /* organiza em coluna */
      gap: 10px;              /* espaço vertical entre linhas */
      border: 1px solid #000;
      border-radius: 5px;
      padding-top: 10px;
      padding-bottom: 20px;
    }

    /* Somente para tela, mantém centralizado se quiser */
    @media screen {
      body {
        display: flex;
        justify-content: center;
        align-items: flex-start; /* ou center se quiser centralizar */
        gap: 20px; /* espaçamento entre páginas na tela */
      }
    }

    @media print {
      body {
        display: block; /* remove o flex */
      }

      .page {
        page-break-after: always;
        width: 210mm;
        height: 297mm;
      }

      #printBtn {
        background: none;
        margin-left: -100%;
      }
    }

    /* Slots */
    .inventory {
      margin-top: 0px;
      text-align: center;
    }

    .inventory h3 {
      margin-bottom: 10px;
      font-size: 18px;
    }

    .slots {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      flex-direction: row;
    }

    .slot {
      width: 40px;
      height: 40px;
      border: 2px solid black;
      border-radius: 5px;
      cursor: pointer;
      background-color: white;
      transition: background 0.2s;
    }

    .slot.filled {
      background-color: black;
    }

    .items-box {
      width: 95%;
      max-width: 95%;      /* ajuste se quiser menor/maior */
      height: 248px;         /* altura fixa */
      padding: 8px;
      border: 1px solid #000;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.4;
      box-sizing: border-box;
      resize: none;          /* ❗ impede redimensionar */
      overflow: auto;        /* aparece scroll se passar do limite */
    }


    /* Mana */
    /* Mana grid (200mm wide) */
    .mana-container{
      width: 200mm;
      height: 20mm;
      margin: 0 auto;
      display: flex;
      grid-template-columns: repeat(25, 8mm); /* 25 cols each 8mm */
      grid-auto-rows: 8mm;                     /* rows with 8mm height */
      gap: 0;                                  /* no gap so 25*8mm == 200mm */
      justify-content: center;                 /* center if any rounding occurs */
      box-sizing: border-box;
      user-select: none;
      flex-wrap: wrap;
    }

    /* each mana cell */
    .mana-box {
      width: 8mm;
      height: 8mm;
      border: 1px solid #6aa0ff;   /* subtle blue border */
      box-sizing: border-box;
      background-color: white;
      cursor: pointer;
      -webkit-touch-callout: none;
      transition: background 0.2s;
    }

    /* filled = blue */
    .mana-box.filled {
      background: linear-gradient(#4ea3ff, #1f7eff);
      border-color: #1f7eff;
      box-shadow: 0 0 4px rgba(31,126,255,0.25) inset;
    }

    /* Upload Image */
    /* estilos - ajuste tamanhos conforme sua ficha */
    .image-uploader { display:flex; }
    .image-placeholder{
      margin: 5px;
      width: 100%;              /* ajuste o tamanho que quiser */
      height: 90%;
      border-radius: 8px;
      border: 2px dashed #bbb;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      background: #fafafa;
      cursor:pointer;
      position:relative;
    }
    .image-placeholder img{
      width:100%;
      height:100%;
      object-fit:cover; /* mantém proporção e preenche */
      display:block;
      border: none;
    }
    .image-placeholder .hint{
      color:#666;
      font-size:13px;
      text-align:center;
      padding:6px;
    }
    /* botão remover (aparece ao passar o mouse) */
    .image-placeholder .remove-btn{
      position:absolute;
      right:6px;
      top:6px;
      background:rgba(0,0,0,0.6);
      color:white;
      border:none;
      padding:4px 6px;
      border-radius:4px;
      cursor:pointer;
      display:none;
      font-size:12px;
    }
    .image-placeholder:hover .remove-btn{ display:block; }

  </style>
</head>
<body>
  <div class="page">
    <!-- Header -->
    <div class="header">
      <button id="printBtn" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">
        Imprimir PDF
      </button>
      <!-- Imagem esquerda -->
      <img src="G.png" alt="Logo Gogryõ">

      <!-- Inputs -->
      <div class="header-fields">
        <div class="input-row">
          <div class="field">
            <input type="text" id="characterName">
            <div class="caption">Character Name</div>
          </div>
          <div class="field">
            <input type="text" id="race">
            <div class="caption">Race</div>
          </div>
        </div>
        <div class="input-row">
          <div class="field">
            <input type="text" id="xpAvailable">
            <div class="caption">XP total</div>
          </div>
          <div class="field">
            <input type="text" id="playername">
            <div class="caption">Player Name</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sub Atributos -->
    <div class="atributes">
        <div style="text-align:center; font-size: 12px;margin-top: -10px;color: gray;">Sub Atributes</div>
       <!-- Tenacity -->

       <!-- Resistance -->
       <div class="bonus-row">
         <input type="checkbox" id="resistanceBonus" style="max-width: 25%;">
         <input type="text" id="resistanceDisplay" class="atbBox" readonly style="margin-left: -25px;">
         <div class="caption">Resistance [TEN]</div>
       </div>
     
       <!-- Toughness -->
       <div class="bonus-row">
         <input type="checkbox" id="tenacityBonus" style="max-width: 25%;">
         <input type="text" id="tenacityDisplay" class="atbBox" readonly style="margin-left: -25px;">
         <div class="caption">Toughness [TEN]</div>
        </div>

        <!-- Dexterity -->
       
       <!-- Agility -->
       <div class="bonus-row">
        <input type="checkbox" id="agilityBonus" style="max-width: 25%;">
        <input type="text" id="agilityDisplay" class="atbBox" readonly style="margin-left: -25px;">
        <div class="caption">Agility [DEX]</div>
      </div>
    
      <!-- Evasion -->
      <div class="bonus-row">
        <input type="checkbox" id="evasionBonus" style="max-width: 25%;">
        <input type="text" id="evasionDisplay" class="atbBox" readonly style="margin-left: -25px;">
        <div class="caption">Evasion [DEX]</div>
       </div>

       <!-- Mind -->
       
       <!-- Wisdom -->
       <div class="bonus-row">
        <input type="checkbox" id="wisdomBonus" style="max-width: 25%;">
        <input type="text" id="wisdomDisplay" class="atbBox" readonly style="margin-left: -25px;">
        <div class="caption">Wisdom [MEN]</div>
      </div>
    
      <!-- Intelligence -->
      <div class="bonus-row">
        <input type="checkbox" id="intelligenceBonus" style="max-width: 25%;">
        <input type="text" id="intelligenceDisplay" class="atbBox" readonly style="margin-left: -25px;">
        <div class="caption">Intelligence [MEN]</div>
       </div>
    </div>

    <!-- Menu -->
    <div class="menu">
      <img src="Menu New.fw.png" alt="Menu Gogryõ">
      <div class="attribute-container" style="top: 50px; left: 45.5%;">
        <input type="text" pattern="0123456789" class="attribute-input" id="strength" value="0" min="0" max="10" maxlength="2">
        <div class="attribute-caption">Strength</div>
      </div>
      <div class="attribute-container" style="top: 130px; left: 32%;">
        <input type="text" pattern="0123456789" class="attribute-input" id="Tenacity" value="0" min="0" max="10" maxlength="2" style="margin-top: -13px;">
        <div class="attribute-caption">Tenacity</div>
      </div>
      <div class="attribute-container" style="top: 130px; left: 59%;">
        <input type="text" pattern="0123456789" class="attribute-input" id="Dexterity" value="0" min="0" max="10" maxlength="2" style="margin-top: -13px;">
        <div class="attribute-caption">Dexterity</div>
      </div>
      <div class="attribute-container" style="top: 220px; left: 45.5%;">
        <input type="text" pattern="0123456789" class="attribute-input" id="Mind" value="0" min="0" max="10" maxlength="2" style="margin-top: -13px;">
        <div class="attribute-caption">Mind</div>
      </div>
    </div>

    <!-- Energy -->
    <div class="caption" style="text-align: center;"> Energy</div>
    <div class="energy-boxes" style="display: flex; justify-content: center; gap: 10px; margin-top: 0px; padding: 20px; border: 1px solid #000; border-radius: 5px;">
      <label class="container">
        <input type="checkbox" id="1" class="eb">
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="2" class="eb">
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="3" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="4" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="5" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="6" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="7" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
      <label class="container">
        <input type="checkbox" id="8" class="eb" disabled>
        <span class="checkmark"></span>
      </label>
    </div>
    <div class="caption" style="text-align: center;">At the start of your turn, gain energy = mastery</div>

    <!-- Body Stats -->
    <div class="main">
        <div class="bonus-row" style="padding-right: 10px;">
          <input type="number" id="currentLife" class="atbBox" value="0" style="margin-right: -10px;width: 50%;">
          <input type="number" id="maxLife" class="atbBox" readonly style="width: 50%;border-left: 1px dashed #000;" value="10">
        </div>
        <div style="text-align:center; font-size: 12px;margin-top: -10px;color: gray; padding-bottom: 20px;">Hit Points</div>
        <div class="bonus-row" style="padding-right: 10px;">
          <img src="bordernew.fw.png" alt="Armor" style="width: 33%;">
          <img src="bordernew.fw.png" alt="Reduction" style="width: 33%;">
          <img src="bordernew.fw.png" alt="Evasion" style="width: 33%;">
        </div>
        <div class="bonus-row" style="padding-right: 10px; margin-top: -55px;">
          <input type="number" id="armormain" style="width: 33%; background: none; border: none;" readonly value="0">
          <input type="number" id="reductionmain" style="width: 33%; background: none; border: none;" readonly value="0">
          <input type="number" id="dodgemain" style="width: 33%; background: none; border: none;" readonly value="0">
        </div>
        <div class="bonus-row" style="padding-right: 10px; margin-top: 0px;">
          <div class="caption" style="width: 33%;text-align: center;">Armor</div>
          <div class="caption" style="width: 33%;text-align: center">Reduction</div>
          <div class="caption" style="width: 33%;text-align: center">Dodge</div>
        </div>
        <div class="bonus-row" style="padding-right: 10px;">
          <div style="width: 16.5%;"></div>
          <img src="bordernew.fw.png" alt="mastery" style="width: 33%;">
          <img src="bordernew.fw.png" alt="Speed" style="width: 33%;">
          <div style="width: 16.5%;"></div>
        </div>
        <div class="bonus-row" style="padding-right: 10px; margin-top: -55px;">
          <div style="width: 16.5%;"></div>
          <input type="number" id="mastery" style="width: 33%; background: none; border: none;" readonly value="2">
          <input type="number" id="speedmain" style="width: 33%; background: none; border: none;" readonly value="9">
          <div style="width: 16.5%;"></div>
        </div>
        <div class="bonus-row" style="padding-right: 10px; margin-top: 0px;">
          <div style="width: 16.5%;"></div>
          <div class="caption" style="width: 33%;text-align: center;">Mastery</div>
          <div class="caption" style="width: 33%;text-align: center;">Speed</div>
          <div style="width: 16.5%;"></div>
        </div>
    </div>

    <!-- Equipment -->
    <div class="equip" style="bottom: -3%;border: 1px solid #000;border-radius: 5px;width: 97.4%;height: auto;">
      <div style="width: 100%; height: 50%;display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;">
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=20 atb=7></div>
          <input type="text" id=20 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;">Initiative [AGI]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=21 atb=8></div>
          <input type="text" id=21 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;">Light armor [EVA]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=22 atb=7></div>
          <input type="text" id=22 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;">Medium armor [AGI]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=23 atb=1></div>
          <input type="text" id=23 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;">Heavy armor [FOR]</div>
        </div>
      </div>
      <div style="width: 100%; height: 50%;margin-top: 10px;display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;">
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=24 atb=1></div>
          <input type="text" id=24 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;font-size: 10px">Common weapons [FOR]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=25 atb=3></div>
          <input type="text" id=25 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;font-size: 10px">Exotic weapons [DEX]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=26 atb=1></div>
          <input type="text" id=26 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;font-size: 10px">Improvised weapons [FOR]</div>
        </div>
        <div class="bonus-row">
          <div id="quadstate" class="state state-0" value=0 index=27 atb=3></div>
          <input type="text" id=27 class="atbBox" readonly style="margin-left: -10px;">
          <div class="caption" style="margin-left: -5px;font-size: 10px">Precision weapons [DEX]</div>
        </div>
      </div>
    </div>

    <!-- Skills -->
    <div class="skills" style="padding-left: 10px;border-right: none; border-radius: 5px 0px 0px 5px;">
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=0 atb=7></div>
        <input type="text" id=0 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Acrobatics [AGI]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=1 atb=10></div>
        <input type="text" id=1 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Alchemy [INT]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=2 atb=9></div>
        <input type="text" id=2 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Animal Handling [WIS]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=3 atb=10></div>
        <input type="text" id=3 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Arcana [INT]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=4 atb=1></div>
        <input type="text" id=4 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Athletics [STR]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=5 atb=1></div>
        <input type="text" id=5 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Brutality [STR]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=6 atb=7></div>
        <input type="text" id=6 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Contortionism [AGI]</div>
      </div>
    </div>
    <div class="skills" style="padding-left: 10px;margin-left: 33%; border-right: none;border-left: none; border-radius: 0px;">
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=7 atb=10></div>
        <input type="text" id=7 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Cryptography [INT]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=8 atb=9></div>
        <input type="text" id=8 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Medicine [WIS]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=9 atb=9></div>
        <input type="text" id=9 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Intuition [WIS]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=10 atb=1></div>
        <input type="text" id=10 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Intimidation (Physical) [FOR]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=11 atb=10></div>
        <input type="text" id=11 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Investigation [INT]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=12 atb=7></div>
        <input type="text" id=12 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Light Hands [AGI]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=13 atb=1></div>
        <input type="text" id=13 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Martial Arts [FOR]</div>
      </div>
    </div>
    <div class="skills" style="padding-left: 10px; width: 29%; margin-left: 66%; border-left: none; border-radius: 0px 5px 5px 0px;">
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=14 atb=7></div>
        <input type="text" id=14 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Quick Reflexes [AGI]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=15 atb=4></div>
        <input type="text" id=15 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Social Insight [MEN]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=16 atb=7></div>
        <input type="text" id=16 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Stealth [AGI]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=17 atb=10></div>
        <input type="text" id=17 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Strategy [INT]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=18 atb=9></div>
        <input type="text" id=18 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Survival [WIS]</div>
      </div>
      <div class="bonus-row">
        <div id="quadstate" class="state state-0" value=0 index=19 atb=1></div>
        <input type="text" id=19 class="atbBox" readonly style="margin-left: -10px;">
        <div class="caption" style="margin-left: -5px;">Workforce [FOR]</div>
      </div>
      <div class="bonus-row" style="padding-bottom: 33px;"></div>
    </div>
  </div>
  <div class="page">
    <div style="display:flex;justify-content: center;align-items: flex-start;gap: 10px;flex-direction:row;width: 100%;">
      <div style="margin: 10px; align-self:baseline; border: 1px solid #000;border-radius: 5px; width: 45%; height: 280px;">
        <div class="caption" style="text-align: center;">Slots</div>
          <div class="inventory">
            <!--<h3>Inventário (Slots)</h3>-->
            <div class="slots">
              <!-- Por padrão vou colocar 10 slots, mas você pode alterar -->
              <div id="slots" class="slots"></div>
            </div>
          </div>
      </div>
      <div style="margin: 10px; border: 1px solid #000;border-radius: 5px; width: 45%; height: 280px;">
        <div class="caption" style="text-align: center;">Equipments</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;padding-bottom: 10px;">
          <textarea id="itemsList" class="items-box" placeholder="List your items here..."></textarea>
        </div>
      </div>
    </div>

    <div style="margin: 10px; border: 1px solid #000;border-radius: 5px; width: 94%; height: 55%;">
      <div class="caption" style="text-align: center;">Experience Points</div>
      <div style="display:flex;justify-content: center;align-items: flex-start;gap: 10px;flex-direction:row;width: 100%; margin-top: 10px;">
        <div class="caption" style="text-align: start;">Mains</div>
        <label style="padding: 2px; border: 1px dashed gray;"> Atribute: New valor * 5 XP</label>
        <label style="padding: 2px; border: 1px dashed gray;"> Mastery: New valor * 6 XP</label>
        <label style="padding: 2px; border: 1px dashed gray;"> Feat: 2 XP</label>
      </div>
      <div style="display:flex;justify-content: center;align-items: flex-start;gap: 10px;flex-direction:row;width: 100%; margin-top: 10px;">
        <div class="caption" style="text-align: start;">Skills</div>
        <label style="padding: 2px; border: 1px dashed gray;"> Inexperienced -> Lay: 3 XP</label>
        <label style="padding: 2px; border: 1px dashed gray;"> Lay -> Proficience: 6 XP</label>
        <label style="padding: 2px; border: 1px dashed gray;"> Proficience -> Expert: 9 XP</label>
      </div>
      <div class="caption" style="text-align: center;margin-top: 30px;">Buy history</div>
      <div style="display:flex;justify-content: center;align-items: flex-start;gap: 10px;flex-direction:row;width: 100%; margin-top: 10px; height: 66%;">
        <textarea id="itemsList" class="items-box" placeholder="List your buys here..." style="width: 97%;max-width: 97%; height: 100%;"></textarea>
      </div>

      <div class="energy-boxes" style="display: flex; justify-content: center;align-items: center; gap: 10px; margin-top: 5px; padding: 5px; border: none;">
        <label>Mastery buy</label>
        <label class="container">
          <input type="checkbox" id="a1" class="ms">
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="checkbox" id="a2" class="ms">
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="checkbox" id="a3" class="ms">
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="checkbox" id="a4" class="ms">
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="checkbox" id="a5" class="ms">
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="checkbox" id="a6" class="ms">
          <span class="checkmark"></span>
        </label>
      </div>
    </div>

    <div style="display:flex;justify-content: center;align-items: flex-start;gap: 10px;flex-direction:row;width: 100%;">
      <div style="margin: 10px; align-self:baseline; border: 1px solid #000;border-radius: 5px; width: 45%; height: auto;">
        <div class="caption" style="text-align: center;">Armor</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;border-bottom: 1px dashed #000; padding-bottom: 15px;">
          <label for="armorSelect">Choose armor:</label>
          <select id="armorSelect" class="armor-listbox">
            <option value="0">Unarmored</option>
            <option value="1">Light Armor</option>
            <option value="2">Medium Armor</option>
            <option value="3">Heavy Armor</option>
          </select>
          <label> + mod:</label>
          <input type="number" class="atbBox" id="armorBonus" value="0">
        </div>
        <div class="caption" style="text-align: center;">Hit Points</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;">
          <label for="armorSelect">Racial Bonus:</label>
          <input type="number" class="atbBox" id="racialbonus" value="0">
          <label> + mod:</label>
          <input type="number" class="atbBox" id="hpmod" value="0">
        </div>
        <div class="caption" style="text-align: center; color: transparent;">space</div>
      </div>
      <div style="margin: 10px; border: 1px solid #000;border-radius: 5px; width: 45%; height: auto;">
        <div style="display: flex;">
          <div style="width: 33%;">
            <div class="caption" style="text-align: center;">Dodge</div>
            <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;border-bottom: 1px dashed #000; padding-bottom: 15px;">
              <label> mod:</label>
              <input type="number" class="atbBox" id="dodgemod" value="0">
            </div>
          </div>
          <div style="width: 33%;">
            <div class="caption" style="text-align: center;">Reduction</div>
            <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;border-bottom: 1px dashed #000; padding-bottom: 15px;">
              <label> mod:</label>
              <input type="number" class="atbBox" id="reductionmod" value="0">
            </div>
          </div>
          <div style="width: 33%;">
            <div class="caption" style="text-align: center;">Slots</div>
            <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;border-bottom: 1px dashed #000; padding-bottom: 15px;">
              <label> mod:</label>
              <input type="number" class="atbBox" id="slotsmod" value="0">
            </div>
          </div>
        </div>
        <div class="caption" style="text-align: center;">Speed</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row;">
          <label for="armorSelect">Racial Base:</label>
          <input type="number" class="atbBox" id="speedbase" value="6">
          <label> + AGI:</label>
          <input type="number" class="atbBox" id="agibase" value="0" readonly>
          <label> + mod:</label>
          <input type="number" class="atbBox" id="speedmod" value="0">
        </div>
        <div class="caption" style="text-align: center; color: transparent;">space</div>
      </div>
    </div>
  </div>

  <div class="page">
    <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; margin: 5px; width: 96%; height: 10%; border: 1px solid #000; border-radius: 5px;">
      <label>Spell Attack:</label>
      <img src="bordernew.fw.png">
      <input type="number" id="spellatk" style="width: 45px; background: none; border: none; margin-left: -72px;" readonly value="0">
      <label style="margin-left: 15%;">Spell DC:</label>
      <img src="bordernew.fw.png">
      <input type="number" id="spelldc" style="width: 45px; background: none; border: none; margin-left: -72px;" readonly value="0">
      <label style="margin-left: 15%;">Mana max:</label>
      <img src="bordernew.fw.png">
      <input type="number" id="manamax" style="width: 45px; background: none; border: none; margin-left: -72px;" maxlength=2 value="0">
    </div>
    <!-- Mana UI: coloque após o elemento do menu -->
    <div style="width:200mm;margin:10px auto;text-align:center;display: flex;justify-content: center;">
      <!--<label style="display:block;margin-bottom:6px">Max Mana:
        <input type="number" id="manamax" style="width:45px;background:none;border:none;text-align:center" maxlength="2" value="10" min="0" max="50">
      </label>-->

      <div id="manaContainer" class="mana-container" aria-label="Mana grid"></div>
    </div>

    <!-- Spells table (rounded box, 96% width) -->
    <div class="spells-box" style="width:94%;margin:5px auto;border-radius:5px;border:1px solid #ddd;padding:12px;background:#fff;">
      <div style="font-weight:700;margin-bottom:8px">Spells</div>
      <div style="overflow:auto">
        <table id="spellsTable" style="width:100%;border-collapse:collapse;font-family:inherit">
          <thead>
            <tr style="background:#f5f5f5">
              <th style="text-align:left;padding:8px;border-bottom:1px solid #e5e5e5">Name</th>
              <th style="width:80px;text-align:center;padding:8px;border-bottom:1px solid #e5e5e5">Level</th>
              <th style="width:80px;text-align:center;padding:8px;border-bottom:1px solid #e5e5e5">Cost</th>
              <th style="width:140px;text-align:left;padding:8px;border-bottom:1px solid #e5e5e5">Type</th>
            </tr>
          </thead>
          <tbody>
            <!-- 15 rows -->
            <!-- Row 1 -->
            <tr>
              <td style="padding:6px;border-bottom:1px solid #fafafa">
                <input type="text" placeholder="Spell name" style="width:100%;border:1px solid #ddd;padding:6px;border-radius:4px;">
              </td>
              <td style="padding:6px;text-align:center;border-bottom:1px solid #fafafa">
                <select style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
                  <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                </select>
              </td>
              <td style="padding:6px;text-align:center;border-bottom:1px solid #fafafa">
                <input type="number" min="0" value="1" style="width:100%;border:1px solid #ddd;padding:6px;border-radius:4px;text-align:center;">
              </td>
              <td style="padding:6px;border-bottom:1px solid #fafafa">
                <select style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
                  <option>Offensive</option>
                  <option>Defensive</option>
                  <option>Support</option>
                  <option>Control</option>
                  <option>Area</option>
                  <option>Reaction</option>
                  <option>Passive</option>
                </select>
              </td>
            </tr>
            
          </tbody>
        </table>
      </div>
    </div>

    <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; width: 96%; height: 53px; border: 1px solid #000; border-radius: 5px;">
      <div style="width: 50%;">
        <div class="caption" style="text-align: center;">Spell Attack</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; padding-bottom: 10px;">
          <label> mod:</label>
          <input type="number" class="atbBox" id="spellatkmod" value="0">
        </div>
      </div>
      <div style="width: 50%;">
        <div class="caption" style="text-align: center;">Spell DC</div>
        <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; padding-bottom: 10px;">
          <label> mod:</label>
          <input type="number" class="atbBox" id="dcmod" value="0">
        </div>
      </div>
    </div>

  </div>

  <div class="page">
    <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; width: 99%; height: auto; border: none; border-radius: 5px;">
      <div style="border: 1px solid #000; border-radius: 5px; width: 40%; height: 600px; margin: 5px 0px 5px 10px;">
        <textarea id="itemsList" class="items-box" placeholder="Character Background..." style="margin: 5px; width: 100%;max-width: 97%; height: 90%; border: none; outline: none;"></textarea>
        <div class="caption" style="text-align: center;">Background</div>
      </div>
      <div style="border: 1px solid #000; border-radius: 5px; width: 60%; height: 600px; margin: 5px 10px 5px 0px;">

        <!-- IMAGE UPLOADER: paste into your HTML where quiser -->
        <div class="image-uploader" id="imageUploader" style="padding: 0px; margin: 0px; width: 100%; height: 600px;">
          <input type="file" id="imageFileInput" accept="image/*" style="display:none">
          <div class="image-placeholder" id="imagePlaceholder">
            <span class="hint">Click to upload image</span>
          </div>
          <!-- hidden input contendo dataURL da imagem (útil para enviar por formulário) -->
          <input type="hidden" id="imageDataUrl" name="imageDataUrl" value="">
        </div>
        <div class="caption" style="text-align: center; margin-top: -40px;">Apperance</div>
      </div>
    </div>
    <div style="display:flex;justify-content: center;align-items: center;gap: 10px;flex-direction:row; width: 99%; height: auto; border: none; border-radius: 5px;">
      <div style="border: 1px solid #000; border-radius: 5px; width: 50%; height: 490px; margin: 5px 0px 5px 10px;">
        <textarea id="itemsList" class="items-box" placeholder="Allies & Organizations..." style="margin: 5px; width: 100%; height: 90%; border: none; outline: none;"></textarea>
        <div class="caption" style="text-align: center;">Allies & Organizations</div>
      </div>
      <div style="border: 1px solid #000; border-radius: 5px; width: 50%; height: 490px; margin: 5px 10px 5px 0px;">
        <textarea id="itemsList" class="items-box" placeholder="Treasures..." style="margin: 5px; width: 100%; height: 90%; border: none; outline: none;"></textarea>
        <div class="caption" style="text-align: center;">Treasures</div>
      </div>
    </div>
  </div>

  <script>

    // Mastery
    const mastery = document.getElementById("mastery");

    // Stats
    const strengthInput= document.getElementById("strength");

    const tenacityInput = document.getElementById("Tenacity");
    const tenacityCheckbox = document.getElementById("tenacityBonus");
    const tenacityDisplay = document.getElementById("tenacityDisplay");
    const resistanceCheckbox = document.getElementById("resistanceBonus");
    const resistanceDisplay = document.getElementById("resistanceDisplay");

    const dexterityInput = document.getElementById("Dexterity");
    const agilityCheckbox = document.getElementById("agilityBonus");
    const agilityDisplay = document.getElementById("agilityDisplay");
    const evasionCheckbox = document.getElementById("evasionBonus");
    const evasionDisplay = document.getElementById("evasionDisplay");
  
    const mindInput = document.getElementById("Mind");
    const wisdomCheckbox = document.getElementById("wisdomBonus");
    const wisdomDisplay = document.getElementById("wisdomDisplay");
    const intelligenceCheckbox = document.getElementById("intelligenceBonus");
    const intelligenceDisplay = document.getElementById("intelligenceDisplay");

    // Main Stats
    const maxHP = document.getElementById("maxLife");
    const cHP = document.getElementById("currentLife");


    const armorSelect = document.getElementById("armorSelect");
    const armorDisplay = document.getElementById("armormain");

    const reducDisplay = document.getElementById("reductionmain");
    const reducbonus = document.getElementById("reductionmod");

    const dodgeDisplay = document.getElementById("dodgemain");
    const dodgebonus = document.getElementById("dodgemod");


    const speedDisplay = document.getElementById("speedmain");
    const agiBase = document.getElementById("agibase");
    const speedbonus = document.getElementById("speedmod");

    // Spell
    const spellatk = document.getElementById("spellatk");
    const spelldc = document.getElementById("spelldc");

    //const box = document.getElementById("quadState");

    function updateTenacityDisplay() {
      let value = parseInt(tenacityInput.value) || 0;
      if (tenacityCheckbox.checked) value += parseInt(mastery.value);
      tenacityDisplay.value = value;
      let value2 = parseInt(tenacityInput.value) || 0;
      if (resistanceCheckbox.checked) value2 += parseInt(mastery.value);
      resistanceDisplay.value = value2;
      updatemaxHP();
      updateReduction();
      updateSkill ()
      updateArmor();
    }

    function updateDexterityDisplay() {
      let value = parseInt(dexterityInput.value) || 0;
      if (agilityCheckbox.checked) value += parseInt(mastery.value);
      agilityDisplay.value = value;
      agiBase.value = value;
      let value2 = parseInt(dexterityInput.value) || 0;
      if (evasionCheckbox.checked) value2 += parseInt(mastery.value);
      evasionDisplay.value = value2;
      updateDodge();
      updateSkill ();
      updateSpeed()
      updateArmor();
    }

    function updateMindDisplay() {
      let value = parseInt(mindInput.value) || 0;
      if (wisdomCheckbox.checked) value += parseInt(mastery.value);
      wisdomDisplay.value = value;
      let value2 = parseInt(mindInput.value) || 0;
      if (intelligenceCheckbox.checked) value2 += parseInt(mastery.value);
      intelligenceDisplay.value = value2;
      updateSkill ()
      updateSpell();
    }

    function updatemaxHP() {
        let value = 10 + 5 * parseInt(tenacityDisplay.value) || 10;
        let racebase = parseInt(document.getElementById("racialbonus").value) || 0;
        let bonus = parseInt(document.getElementById("hpmod").value) || 0;
        value += racebase + bonus;
        maxHP.value = value;
    }

    function updateReduction() {
      let value = parseInt(resistanceDisplay.value) || 0;
      let bonus = parseInt(reducbonus.value) || 0;
      reducDisplay.value = value + bonus;
    }

    function updateArmor() {
      let armor = parseInt(armorSelect.value) || 0;
      let bonus = parseInt(document.getElementById("armorBonus").value) || 0;
      let type = "";
      let value = 0;

      switch (armor) {
        case 0:
          value = bonus;
          break;
        case 1:
          type = "21"
          value = parseInt(document.getElementById(type).value) + bonus;
          break;
        case 2:
          type = "22"
          value = 2 + parseInt(document.getElementById(type).value) + bonus;
          break;
        case 3:
          type = "23"
          value = 10 + parseInt(document.getElementById(type).value) + bonus;
          break;
      }

      armorDisplay.value = value;
    }

    function updateDodge() {
      let value = parseInt(evasionDisplay.value) || 0;
      let bonus = parseInt(dodgebonus.value) || 0;
      dodgeDisplay.value = value + bonus;
    }

    function updateSpeed() {
      let Base = parseInt(document.getElementById("speedbase").value) || 0;
      let Agi = parseInt(agiBase.value) || 0;
      let bonus = parseInt(speedbonus.value) || 0;

      let value = Base + Agi + bonus;
      speedDisplay.value = value
    }

    function updateSpell() {
      let index = "3";
      console.log(index);
      let arcana = [...document.getElementsByClassName("atbBox")]
            .find(el => el.id === index);

      let atkValue = parseInt(arcana.value) || 0;
      let atkbonus = parseInt(document.getElementById("spellatkmod").value) || 0;

      spellatk.value = atkValue + atkbonus;

      let Insight = parseInt(document.getElementById("9").value) || 0;
      let dcbonus = parseInt(document.getElementById("dcmod").value) || 0;

      spelldc.value = 5 + Insight + dcbonus;
    }
    
    // --- Energies management ---
    function activateEnergiesFromMastery() {
      const masteryVal = parseInt(mastery.value, 10) || 0;
      for (let i = 1; i <= 8; i++) {
        const cb = document.getElementById(String(i)); // seus checkboxes tem id "1","2",...
        if (!cb) continue;
        if (i <= masteryVal) {
          cb.disabled = false;   // se quiser apenas habilitar sem marcar, troque para false
        } else {
          cb.disabled = true;
          cb.checked = false;
        }
      }
    }

    // liga os eventos nos checkboxes de energy (classe "eb")
    document.querySelectorAll('.eb').forEach(cb => {
      cb.addEventListener('change', function () {
        const idNum = parseInt(this.id, 10);
        if (isNaN(idNum)) return;

        if (this.checked) {
          // se marcou o checkbox n -> marque 1..n e desmarque n+1..8
          for (let i = 1; i <= 8; i++) {
            const c = document.getElementById(String(i));
            if (!c) continue;
            if (i <= idNum) {
              if (!c.disabled) c.checked = true;
            } else {
              c.checked = false;
            }
          }
        } else {
          // se desmarcou n -> marque 1..n-1 (se não disabled) e desmarque n..8
          for (let i = 1; i <= 8; i++) {
            const c = document.getElementById(String(i));
            if (!c) continue;
            if (i < idNum) {
              if (!c.disabled) c.checked = true;
            } else {
              c.checked = false;
            }
          }
        }
      });
    });

    // liga os eventos nos checkboxes de energy (classe "ms")
    document.querySelectorAll('.ms').forEach(msb => {
      msb.addEventListener('change', function () {
        const idNum = parseInt(String(this.id).slice(1, 2), 10);
        let i = 0;
        if (isNaN(idNum)) return;

        if (this.checked) {
          // se marcou o checkbox n -> marque 1..n e desmarque n+1..8
          for (let i = 1; i <= 8; i++) {
            const c = document.getElementById(`a${i}`);
            if (!c) continue;
            if (i <= idNum) {
              if (!c.disabled) c.checked = true;
            } else {
              c.checked = false;
            }
          }
        } else {
          // se desmarcou n -> marque 1..n-1 (se não disabled) e desmarque n..8
          i += 1;
          for (let i = 1; i <= 8; i++) {
            const c = document.getElementById(`a${i}`);
            if (!c) continue;
            if (i < idNum) {
              if (!c.disabled) c.checked = true;
            } else {
              c.checked = false;
            }
          }
        }
        mastery.value = 2 + idNum - i;
        updateTenacityDisplay();
        updateDexterityDisplay();
        updateMindDisplay();
        updatemaxHP();
        updateReduction();
        updateDodge();
        activateEnergiesFromMastery();
        updateSkill();
        updateArmor();
        updateSpell();
        gerarSlots();
      });
    });

    
    let state = 0;

    function updateBox() {
      state = parseInt(box.value) || 0;
      state = (state + 1) % 4; // ciclo 0 → 1 → 2 → 3 → 0...
      box.value = state;
      box.className = `state state-${state}`;
      console.log("Estado atual:", state);
    }
    strengthInput.addEventListener("input", updateSkill);
    strengthInput.addEventListener("input", gerarSlots);

    tenacityInput.addEventListener("input", updateTenacityDisplay);
    tenacityCheckbox.addEventListener("change", updateTenacityDisplay);
    resistanceCheckbox.addEventListener("change", updateTenacityDisplay);
  
    dexterityInput.addEventListener("input", updateDexterityDisplay);
    agilityCheckbox.addEventListener("change", updateDexterityDisplay);
    evasionCheckbox.addEventListener("change", updateDexterityDisplay);

    mindInput.addEventListener("input", updateMindDisplay);
    wisdomCheckbox.addEventListener("change", updateMindDisplay);
    intelligenceCheckbox.addEventListener("change", updateMindDisplay);

    document.getElementById("racialbonus").addEventListener("input", updatemaxHP);
    document.getElementById("hpmod").addEventListener("input", updatemaxHP);

    armorSelect.addEventListener("change", updateArmor);
    document.getElementById("armorBonus").addEventListener("input", updateArmor);

    reducbonus.addEventListener("input", updateReduction);

    dodgebonus.addEventListener("input", updateDodge);

    speedbonus.addEventListener("input", updateSpeed);
    document.getElementById("speedbase").addEventListener("input", updateSpeed);
    
    document.getElementById("slotsmod").addEventListener("input", gerarSlots);
    
    document.getElementById("spellatkmod").addEventListener("input", updateSpell);
    document.getElementById("dcmod").addEventListener("input", updateSpell);
    /*document.querySelectorAll("quadState").forEach(box => {
      box.addEventListener("click", updateBox);
    });*/

    /*document.querySelectorAll(".state").forEach(box => {
      box.addEventListener("click", () => {
        let state = parseInt(box.getAttribute("value")) || 0;
        state = (state + 1) % 4; // ciclo 0 → 1 → 2 → 3 → 0...
        box.setAttribute("value", state);
        box.className = `quadState state-${state}`;
        console.log("Estado atual:", state);
      });
    });*/

    document.querySelectorAll("#quadstate").forEach(box => {
      box.addEventListener("click", () => {
        // Atualiza o estado cíclico
        let state = parseInt(box.getAttribute("value")) || 0;
        state = (state + 1) % 4; 
        box.setAttribute("value", state);
        box.className = `state state-${state}`;

        updateSkill();
        // Pega o índice e o atributo linkado
        /*let index = box.getAttribute("index");
        let atb = parseInt(box.getAttribute("atb"));

        // Faz o cálculo dependendo do estado
        let base = parseInt(pickAtribute(atb)) || 0;
        let mastery = parseInt(pickAtribute(0)) || 0;
        let result = 0;

        switch (state) {
          case 0:
            result = base;
            break;
          case 1:
            result = base + Math.floor(mastery / 2);
            break;
          case 2:
            result = base + mastery;
            break;
          case 3:
            result = base + 2 * mastery;
            break;
        }

        // Atualiza o input correspondente
        let input = [...document.getElementsByClassName("atbBox")]
              .find(el => el.id === index);
        if (input) {
          input.value = result;
        }

        console.log(`Index: ${index}, Atb: ${atb}, Estado: ${state}, Valor: ${result}, base: ${base}`);*/
      });
    });

    function updateSkill(){
      document.querySelectorAll("#quadstate").forEach(box => {
          // Atualiza o estado cíclico
          let state = parseInt(box.getAttribute("value")) || 0;

          // Pega o índice e o atributo linkado
          let index = box.getAttribute("index");
          let atb = parseInt(box.getAttribute("atb"));

          // Faz o cálculo dependendo do estado
          let base = parseInt(pickAtribute(atb)) || 0;
          let mastery = parseInt(pickAtribute(0)) || 0;
          let result = 0;

          switch (state) {
            case 0:
              result = base;
              break;
            case 1:
              result = base + Math.floor(mastery / 2);
              break;
            case 2:
              result = base + mastery;
              break;
            case 3:
              result = base + 2 * mastery;
              break;
          }

          // Atualiza o input correspondente
          let input = [...document.getElementsByClassName("atbBox")]
                .find(el => el.id === index);
          if (input) {
            input.value = result;
          }

          console.log(`Index: ${index}, Atb: ${atb}, Estado: ${state}, Valor: ${result}, base: ${base}`);
      });
      updateArmor();
      updateSpell();
    }

    function pickAtribute(value) {
      switch (value) {
        case 0:
          return mastery.value;
          break;
        case 1:
          return strengthInput.value;
          break;
        case 2:
          return tenacityInput.value;
          break;
        case 3:
          return dexterityInput.value;
          break;
        case 4:
          return mindInput.value;
          break;
        case 5:
          return tenacityDisplay.value;
          break;
        case 6:
          return resistanceDisplay.value;
          break;
        case 7:
          return agilityDisplay.value;
          break;
        case 8:
          return evasionDisplay.value;
          break;
        case 9:
          return wisdomDisplay.value;
          break;
        case 10:
          return intelligenceDisplay.value;
          break;
      }
    }

    document.querySelectorAll('.slot').forEach(slot => {
      slot.addEventListener('click', () => {
        slot.classList.toggle('filled');
      });
    });

    function gerarSlots() {
      let forca = parseInt(strengthInput.value) || 0;
      let bonusFlat = parseInt(document.getElementById("slotsmod").value) || 0;

      const container = document.getElementById("slots");
      container.innerHTML = ""; // limpa se já existirem slots

      const totalSlots = 1 + forca + bonusFlat;

      for (let i = 0; i < totalSlots; i++) {
        const slot = document.createElement("div");
        slot.classList.add("slot");
        slot.addEventListener("click", () => {
          slot.classList.toggle("filled");
        });
        container.appendChild(slot);
      }
      console.log(`find`)
    }

    (function(){
    const MAX_CELLS = 50; // 2 rows × 25 cols
    const manamaxInput = document.getElementById('manamax');
    const manaContainer = document.getElementById('manaContainer');

    // cria N células (exatamente n), todas preenchidas inicialmente
    function createManaCells(n){
      // clamp
      let val = parseInt(n, 10);
      if (isNaN(val)) val = 0;
      if (val < 0) val = 0;
      if (val > MAX_CELLS) val = MAX_CELLS;

      manaContainer.innerHTML = ''; // remove anteriores

      for(let i = 0; i < val; i++){
        const cell = document.createElement('div');
        cell.className = 'mana-box filled';
        cell.dataset.index = i;
        // toggle filled state on click so user can mark spent mana
        cell.addEventListener('click', () => {
          cell.classList.toggle('filled');
        });
        manaContainer.appendChild(cell);
      }

      // NOTE: não criamos células vazias além de N — assim a quantidade de quadrados
      // exibidos é exatamente igual a manamax.
    }

    // listener: quando o input muda, cria exatamente manamax quadrados
    manamaxInput.addEventListener('input', (e) => {
      createManaCells(e.target.value);
    });

    // inicializa com valor atual do input
    createManaCells(manamaxInput.value || 0);

    // função pública opcional
    window.setManaMax = function(v){
      manamaxInput.value = v;
      createManaCells(v);
    };
    })();

    // Linhas de magias
    document.addEventListener('DOMContentLoaded', () => {
    const tbody = document.querySelector('#spellsTable tbody');
    if (!tbody) {
      console.warn('No tbody found for #spellsTable');
      return;
    }

    // template de uma linha de spell (usamos template string para clareza)
    function spellRowTemplate() {
      return `
        <tr>
          <td style="padding:6px;border-bottom:1px solid #fafafa">
            <input type="text" class="spell-name" placeholder="Spell name" style="width:100%;border:1px solid #ddd;padding:6px;border-radius:4px;">
          </td>
          <td style="padding:6px;text-align:center;border-bottom:1px solid #fafafa">
            <select class="spell-level" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </td>
          <td style="padding:6px;text-align:center;border-bottom:1px solid #fafafa">
            <input type="number" class="spell-cost" min="0" value="1" style="width:100%;border:1px solid #ddd;padding:6px;border-radius:4px;text-align:center;">
          </td>
          <td style="padding:6px;border-bottom:1px solid #fafafa">
            <select class="spell-type" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
              <option>Offensive</option>
              <option>Defensive</option>
              <option>Support</option>
              <option>Control</option>
              <option>Area</option>
              <option>Reaction</option>
              <option>Passive</option>
            </select>
          </td>
        </tr>
      `;
    }

    // função que populates N linhas (limpa antes)
    function populateSpellRows(count = 15) {
      tbody.innerHTML = ''; // limpa linhas existentes
      const frag = document.createDocumentFragment();
      for (let i = 0; i < count; i++) {
        const tr = document.createElement('tr');
        tr.innerHTML = spellRowTemplate();
        frag.appendChild(tr);
      }
      tbody.appendChild(frag);
    }

    // popula as 15 linhas iniciais
    populateSpellRows(15);

    // expõe função global caso queira recriar dinamicamente depois
    window.populateSpellRows = populateSpellRows;
    });

    (function(){
    const fileInput = document.getElementById('imageFileInput');
    const placeholder = document.getElementById('imagePlaceholder');
    const hiddenData = document.getElementById('imageDataUrl');

    const MAX_BYTES = 10 * 1024 * 1024; // 2 MB max (ajuste se quiser)

    // cria botão remover (aparece quando há imagem)
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'remove-btn';
    removeBtn.textContent = 'Remove';
    placeholder.appendChild(removeBtn);

    // abrir seletor ao clicar na área
    placeholder.addEventListener('click', () => {
      fileInput.click();
    });

    // remover imagem
    removeBtn.addEventListener('click', (ev) => {
      ev.stopPropagation(); // evita reabrir o seletor
      clearImage();
    });

    fileInput.addEventListener('change', (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file.');
        fileInput.value = '';
        return;
      }
      if (file.size > MAX_BYTES) {
        alert('Image too large. Max 2 MB.');
        fileInput.value = '';
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e){
        showImage(e.target.result); // dataURL
        hiddenData.value = e.target.result; // guarda para enviar no form
      };
      reader.readAsDataURL(file);
    });

    function showImage(dataUrl){
      // remove texto de hint se existir e imagem antiga
      placeholder.querySelectorAll('img, .hint').forEach(n=>n.remove());
      const img = document.createElement('img');
      img.src = dataUrl;
      placeholder.appendChild(img);
      // ensure remove button visible on hover (already appended)
    }

    function clearImage(){
      // remove imagem e restaura hint
      placeholder.querySelectorAll('img, .hint').forEach(n=>n.remove());
      const hint = document.createElement('span');
      hint.className = 'hint';
      hint.textContent = 'Click to upload image';
      placeholder.appendChild(hint);
      fileInput.value = '';
      hiddenData.value = '';
    }

    // inicializa - se quiser exibir uma imagem pré-carregada (dataURL) basta
    // setar hiddenData.value = 'data:image/...'; e chamar showImage(hiddenData.value)
    (function init(){
      // se tiver valor inicial no hiddenData (ex: carregado pelo servidor), mostra
      if(hiddenData.value){
        showImage(hiddenData.value);
      }
    })();
  })();

    document.getElementById("printBtn").addEventListener("click", () => {
      window.print(); // abre a caixa de diálogo de impressão
    });

    updateTenacityDisplay();
    updateDexterityDisplay();
    updateMindDisplay();
    updatemaxHP();
    updateReduction();
    updateDodge();
    activateEnergiesFromMastery();
    updateSkill();
    updateArmor();
    gerarSlots();
  </script>
</body>
</html>
